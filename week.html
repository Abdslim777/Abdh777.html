<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ø³ØªÙ‚Ø± v12</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root { --bg: #0a0c10; --card: #1c1f26; --primary: #238636; --gold: #f0883e; }
        body { background: var(--bg); color: #c9d1d9; font-family: sans-serif; margin: 0; padding: 10px; }
        .container { max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: 1fr 350px; gap: 15px; }
        .panel { background: var(--card); border-radius: 12px; border: 1px solid #30363d; padding: 20px; }
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; text-align: center; }
        .stat-card { background: #0d1117; padding: 15px; border-radius: 8px; border-top: 3px solid #58a6ff; }
        .stat-card b { display: block; font-size: 1.3rem; color: white; }
        .chat-box { background: #0d1117; height: 200px; overflow-y: auto; padding: 10px; border-radius: 8px; border: 1px solid #30363d; margin-top: 15px; font-size: 0.85rem; }
        .treasure-list { background: rgba(240, 136, 62, 0.05); border: 1px solid var(--gold); border-radius: 12px; height: 500px; overflow-y: auto; padding: 15px; }
        .wallet-item { background: #161b22; padding: 10px; margin-bottom: 8px; border-radius: 6px; border-right: 4px solid var(--gold); font-family: monospace; font-size: 0.8rem; }
        .btn { background: var(--primary); color: white; border: none; padding: 10px; border-radius: 5px; width: 100%; cursor: pointer; font-weight: bold; }
        .pulse { width: 10px; height: 10px; background: #238636; border-radius: 50%; display: inline-block; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div class="main">
        <div class="panel">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>ğŸ“¡ Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ø§Ù„Ø°ÙƒÙŠ</h3>
                <span id="syncStatus" style="font-size: 0.7rem; color: #8b949e;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
            </div>
            
            <div class="stat-grid">
                <div class="stat-card"><small>Ø§Ù„Ù…Ø¤Ø´Ø±</small><b id="idx">0</b></div>
                <div class="stat-card"><small>Ø§Ù„Ù…Ù„Ù</small><b id="total">0</b></div>
                <div class="stat-card" style="border-color:var(--gold)"><small>Ø§Ù„ÙƒÙ†ÙˆØ²</small><b id="foundCount">0</b></div>
            </div>

            <button id="btn" class="btn" onclick="toggle()">Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„ÙŠØ¯ÙˆÙŠ/Ø§Ù„Ø¢Ù„ÙŠ</button>
            <div class="chat-box" id="msgs"></div>
            <div style="display:flex; gap:5px; margin-top:10px;">
                <input type="text" id="chatIn" style="flex:1; background:#0d1117; color:white; border:1px solid #333; padding:8px; border-radius:4px;" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§...">
                <button onclick="sendMsg()" class="btn" style="width:70px;">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
    </div>

    <div class="treasure-list">
        <h4 style="color:var(--gold); margin-top:0;">ğŸ’ Ø§Ù„ÙƒÙ†ÙˆØ² Ø§Ù„Ù…ÙƒØªØ´ÙØ©</h4>
        <div id="foundList"></div>
    </div>
</div>

<script>
    // ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¯ÙŠÙ„Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±
    const config = { databaseURL: "https://community-scanner-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(config);
    const db = firebase.database();

    let scanning = false;
    let addresses = [];
    let localIdx = parseInt(localStorage.getItem('my_index')) || 0;
    const name = "Hunter-" + Math.floor(Math.random()*999);
    const RPCs = ['https://eth.llamarpc.com', 'https://bsc-dataseed.binance.org', 'https://polygon-rpc.com'];

    // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø¤Ø´Ø± Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
    db.ref('global_idx').on('value', s => {
        let cloudIdx = s.val() || 0;
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ¨Ø± Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©
        localIdx = Math.max(localIdx, cloudIdx);
        document.getElementById('idx').innerText = localIdx.toLocaleString();
        saveProgress();
    });

    db.ref('found').limitToLast(10).on('child_added', s => renderW(s.val()));
    db.ref('chat').limitToLast(20).on('child_added', s => renderM(s.val()));

    async function load() {
        try {
            const r = await fetch('32.txt');
            const t = await r.text();
            addresses = t.split(/\s+/).filter(a => ethers.utils.isAddress(a.trim()));
            document.getElementById('total').innerText = addresses.length.toLocaleString();
            document.getElementById('syncStatus').innerText = "âœ… Ù…ØªØµÙ„ ÙˆØ¬Ø§Ù‡Ø²";
            // ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
            setTimeout(() => { if(!scanning) toggle(); }, 2000);
        } catch(e) { document.getElementById('syncStatus').innerText = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ù„Ù"; }
    }

    function toggle() {
        scanning = !scanning;
        document.getElementById('btn').innerText = scanning ? "ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù" : "â–¶ï¸ Ø§Ø³ØªØ¦Ù†Ø§Ù";
        document.getElementById('btn').style.background = scanning ? "#da3633" : "#238636";
        if(scanning) run();
    }

    async function run() {
        const BATCH = 25;
        while(scanning && localIdx < addresses.length) {
            const batch = addresses.slice(localIdx, localIdx + BATCH);
            await Promise.all(batch.map(async (a) => {
                const b = await check(a.trim());
                if(b) {
                    db.ref('found').push({ a, b, n: name });
                    db.ref('chat').push({ n: "ğŸ¤– Ø±Ø§Ø¯Ø§Ø±", m: `Ø±ØµØ¯ ÙƒÙ†Ø² Ù…Ø¹ ${name}` });
                }
            }));
            localIdx += BATCH;
            saveProgress();
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø­Ø§Ø¨Ø© ÙƒÙ„ Ø¯ÙØ¹ØªÙŠÙ† Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¶ØºØ· ÙˆØ¶Ù…Ø§Ù† Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
            if(localIdx % 50 === 0) db.ref('global_idx').set(localIdx);
            await new Promise(r => setTimeout(r, 150));
        }
    }

    async function check(a) {
        try {
            const p = new ethers.providers.JsonRpcProvider(RPCs[Math.floor(Math.random()*RPCs.length)]);
            const b = await p.getBalance(a);
            return b.gt(0) ? ethers.utils.formatEther(b).substring(0,8) : null;
        } catch { return null; }
    }

    function saveProgress() {
        document.getElementById('idx').innerText = localIdx.toLocaleString();
        localStorage.setItem('my_index', localIdx);
    }

    function sendMsg() {
        const i = document.getElementById('chatIn');
        if(i.value) db.ref('chat').push({ n: name, m: i.value });
        i.value = "";
    }

    function renderM(c) {
        const d = document.createElement('div');
        d.innerHTML = `<small style="color:#58a6ff">${c.n}:</small> ${c.m}`;
        const box = document.getElementById('msgs');
        box.appendChild(d);
        box.scrollTop = box.scrollHeight;
    }

    function renderW(w) {
        const d = document.createElement('div');
        d.className = 'wallet-item';
        d.innerHTML = `<b style="color:var(--gold)">${w.b} ETH/BNB</b><br><small>${w.a}</small>`;
        document.getElementById('foundList').prepend(d);
        document.getElementById('foundCount').innerText = document.getElementById('foundList').childElementCount;
    }

    window.onload = load;
</script>
</body>
</html>
