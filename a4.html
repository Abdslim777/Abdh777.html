<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تشغيل ملفات GitHub تفاعلياً</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .input-section, .preview-section, .control-section {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 25px;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #3498db;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .section-title i {
            font-size: 1.3rem;
        }

        .url-input {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .url-input label {
            font-weight: bold;
            color: #2c3e50;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .input-group input:focus {
            border-color: #3498db;
            outline: none;
        }

        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .example-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .example-link {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 8px 15px;
            border-radius: 20px;
            color: #3498db;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .example-link:hover {
            background-color: #3498db;
            color: white;
        }

        .preview-container {
            border: 2px solid #eee;
            border-radius: 10px;
            overflow: hidden;
            height: 500px;
            position: relative;
        }

        .preview-header {
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-title {
            font-weight: bold;
            color: #2c3e50;
        }

        .preview-actions {
            display: flex;
            gap: 10px;
        }

        .preview-actions button {
            background: none;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .preview-actions button:hover {
            background-color: #f0f0f0;
        }

        #previewFrame {
            width: 100%;
            height: calc(100% - 45px);
            border: none;
            background-color: white;
        }

        .code-container {
            background-color: #2d3748;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        .code-header {
            background-color: #1a202c;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-title {
            color: #e2e8f0;
            font-weight: bold;
            font-family: monospace;
        }

        .code-content {
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            color: #e2e8f0;
            white-space: pre-wrap;
            line-height: 1.5;
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .status-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #3498db;
        }

        .loading.active {
            display: block;
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .file-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }
            
            .preview-container {
                height: 400px;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-code"></i> تشغيل ملفات GitHub تفاعلياً</h1>
            <p class="subtitle">
                هذه الأداة تتيح لك الوصول إلى أي ملف HTML على GitHub وتشغيله بشكل تفاعلي. 
                فقط أدخل رابط الملف واضغط على "تشغيل" لرؤية النتيجة.
            </p>
        </header>

        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title"><i class="fas fa-link"></i> رابط ملف GitHub</h2>
                <div class="url-input">
                    <label for="githubUrl">أدخل رابط ملف HTML من GitHub:</label>
                    <div class="input-group">
                        <input type="text" id="githubUrl" 
                               placeholder="https://github.com/username/repository/blob/branch/path/to/file.html"
                               value="https://github.com/Abdslim777/Abdh/blob/main/gg.html">
                        <button id="loadBtn" class="btn">
                            <i class="fas fa-play-circle"></i> تشغيل الملف
                        </button>
                    </div>
                    
                    <div class="example-links">
                        <span>أمثلة:</span>
                        <a href="#" class="example-link" data-url="https://github.com/Abdslim777/Abdh/blob/main/gg.html">ملف المثال</a>
                        <a href="#" class="example-link" data-url="https://github.com/microsoft/TypeScript/blob/main/README.md">README TypeScript</a>
                        <a href="#" class="example-link" data-url="https://github.com/twbs/bootstrap/blob/main/index.html">Bootstrap مثال</a>
                    </div>
                </div>
                
                <div class="loading" id="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>جاري جلب الملف وتشغيله...</p>
                </div>
                
                <div id="statusMessage" class="status-message"></div>
            </div>

            <div class="preview-section">
                <h2 class="section-title"><i class="fas fa-desktop"></i> معاينة النتيجة</h2>
                <div class="preview-container">
                    <div class="preview-header">
                        <div class="preview-title">نتيجة تشغيل الملف</div>
                        <div class="preview-actions">
                            <button id="refreshBtn"><i class="fas fa-redo"></i> تحديث</button>
                            <button id="fullscreenBtn"><i class="fas fa-expand"></i> ملء الشاشة</button>
                        </div>
                    </div>
                    <iframe id="previewFrame" sandbox="allow-scripts allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin"></iframe>
                </div>
                
                <div class="code-container">
                    <div class="code-header">
                        <div class="code-title">محتوى الملف</div>
                        <div>
                            <button id="copyCodeBtn" class="btn" style="padding: 5px 10px; font-size: 0.8rem;">
                                <i class="far fa-copy"></i> نسخ الكود
                            </button>
                        </div>
                    </div>
                    <div class="code-content" id="codeContent">
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-code fa-2x" style="color: #4a5568; margin-bottom: 10px;"></i>
                            <p>سيظهر محتوى الملف هنا بعد تحميله</p>
                        </div>
                    </div>
                </div>
                
                <div class="file-info" id="fileInfo">
                    <h3><i class="fas fa-info-circle"></i> معلومات الملف</h3>
                    <p>لم يتم تحميل أي ملف بعد. أدخل رابط ملف GitHub واضغط على "تشغيل الملف".</p>
                </div>
            </div>

            <div class="control-section">
                <h2 class="section-title"><i class="fas fa-cogs"></i> خيارات إضافية</h2>
                <div style="display: flex; flex-wrap: wrap; gap: 15px;">
                    <button id="clearBtn" class="btn" style="background-color: #e74c3c;">
                        <i class="fas fa-trash-alt"></i> مسح الكل
                    </button>
                    <button id="saveBtn" class="btn" style="background-color: #2ecc71;">
                        <i class="fas fa-save"></i> حفظ الكود محلياً
                    </button>
                    <button id="newTabBtn" class="btn" style="background-color: #9b59b6;">
                        <i class="fas fa-external-link-alt"></i> فتح في تبويب جديد
                    </button>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3 style="color: #2c3e50; margin-bottom: 10px;">كيفية الاستخدام:</h3>
                    <ol style="padding-right: 20px; color: #555;">
                        <li>انسخ رابط ملف HTML من GitHub (يجب أن يكون الرابط مباشراً للملف)</li>
                        <li>الصق الرابط في الحقل أعلاه واضغط على "تشغيل الملف"</li>
                        <li>ستظهر النتيجة في إطار المعاينة أعلاه</li>
                        <li>يمكنك نسخ الكود أو حفظه أو فتحه في تبويب جديد</li>
                    </ol>
                </div>
            </div>
        </div>

        <footer>
            <p>تم التطوير باستخدام GitHub API | هذه الأداة تعمل على تشغيل ملفات HTML وجافا سكريبت من GitHub بشكل آمن</p>
            <p style="margin-top: 10px;">&copy; 2023 - جميع الحقوق محفوظة</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // عناصر DOM
            const githubUrlInput = document.getElementById('githubUrl');
            const loadBtn = document.getElementById('loadBtn');
            const previewFrame = document.getElementById('previewFrame');
            const codeContent = document.getElementById('codeContent');
            const statusMessage = document.getElementById('statusMessage');
            const loading = document.getElementById('loading');
            const fileInfo = document.getElementById('fileInfo');
            const refreshBtn = document.getElementById('refreshBtn');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const copyCodeBtn = document.getElementById('copyCodeBtn');
            const clearBtn = document.getElementById('clearBtn');
            const saveBtn = document.getElementById('saveBtn');
            const newTabBtn = document.getElementById('newTabBtn');
            const exampleLinks = document.querySelectorAll('.example-link');
            
            // مثال تلقائي عند التحميل
            window.addEventListener('load', function() {
                // تحميل ملف المثال تلقائياً بعد ثانيتين
                setTimeout(() => {
                    loadFileFromUrl(githubUrlInput.value);
                }, 1000);
            });
            
            // تحميل الملف عند النقر على الزر
            loadBtn.addEventListener('click', function() {
                const url = githubUrlInput.value.trim();
                if (!url) {
                    showError('يرجى إدخال رابط ملف GitHub');
                    return;
                }
                
                loadFileFromUrl(url);
            });
            
            // تحديث المعاينة
            refreshBtn.addEventListener('click', function() {
                if (previewFrame.src && previewFrame.src !== 'about:blank') {
                    previewFrame.contentWindow.location.reload();
                }
            });
            
            // وضع ملء الشاشة
            fullscreenBtn.addEventListener('click', function() {
                if (previewFrame.requestFullscreen) {
                    previewFrame.requestFullscreen();
                } else if (previewFrame.mozRequestFullScreen) {
                    previewFrame.mozRequestFullScreen();
                } else if (previewFrame.webkitRequestFullscreen) {
                    previewFrame.webkitRequestFullscreen();
                } else if (previewFrame.msRequestFullscreen) {
                    previewFrame.msRequestFullscreen();
                }
            });
            
            // نسخ الكود
            copyCodeBtn.addEventListener('click', function() {
                const codeText = codeContent.innerText;
                if (!codeText || codeText.includes('سيظهر محتوى الملف هنا بعد تحميله')) {
                    showError('لا يوجد كود للنسخ');
                    return;
                }
                
                navigator.clipboard.writeText(codeText)
                    .then(() => {
                        showSuccess('تم نسخ الكود إلى الحافظة');
                    })
                    .catch(err => {
                        showError('فشل نسخ الكود: ' + err);
                    });
            });
            
            // مسح الكل
            clearBtn.addEventListener('click', function() {
                previewFrame.src = 'about:blank';
                codeContent.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-code fa-2x" style="color: #4a5568; margin-bottom: 10px;"></i>
                        <p>سيظهر محتوى الملف هنا بعد تحميله</p>
                    </div>
                `;
                fileInfo.innerHTML = `
                    <h3><i class="fas fa-info-circle"></i> معلومات الملف</h3>
                    <p>لم يتم تحميل أي ملف بعد. أدخل رابط ملف GitHub واضغط على "تشغيل الملف".</p>
                `;
                statusMessage.style.display = 'none';
                githubUrlInput.value = '';
                showSuccess('تم مسح جميع البيانات');
            });
            
            // حفظ الكود محلياً
            saveBtn.addEventListener('click', function() {
                const codeText = codeContent.innerText;
                if (!codeText || codeText.includes('سيظهر محتوى الملف هنا بعد تحميله')) {
                    showError('لا يوجد كود لحفظه');
                    return;
                }
                
                const blob = new Blob([codeText], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'github_file.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showSuccess('تم حفظ الملف محلياً');
            });
            
            // فتح في تبويب جديد
            newTabBtn.addEventListener('click', function() {
                if (previewFrame.src && previewFrame.src !== 'about:blank') {
                    window.open(previewFrame.src, '_blank');
                } else {
                    showError('لا يوجد ملف مفتوح لفتحه في تبويب جديد');
                }
            });
            
            // أمثلة سريعة
            exampleLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const url = this.getAttribute('data-url');
                    githubUrlInput.value = url;
                    loadFileFromUrl(url);
                });
            });
            
            // دالة لتحميل الملف من URL
            function loadFileFromUrl(url) {
                // إظهار مؤشر التحميل
                loading.classList.add('active');
                statusMessage.style.display = 'none';
                
                // تحويل رابط GitHub إلى رابط API
                let apiUrl = convertToApiUrl(url);
                
                if (!apiUrl) {
                    showError('رابط GitHub غير صالح. يرجى التأكد من أنه رابط مباشر لملف');
                    loading.classList.remove('active');
                    return;
                }
                
                // جلب الملف باستخدام GitHub API
                fetch(apiUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`خطأ في جلب الملف: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // فك تشفير محتوى Base64
                        const content = atob(data.content.replace(/\n/g, ''));
                        
                        // عرض محتوى الكود
                        displayCodeContent(content, data.name, data.path);
                        
                        // إنشاء blob وتشغيله في iframe
                        const blob = new Blob([content], { type: 'text/html' });
                        const blobUrl = URL.createObjectURL(blob);
                        previewFrame.src = blobUrl;
                        
                        // إظهار معلومات الملف
                        displayFileInfo(data);
                        
                        // إظهار رسالة النجاح
                        showSuccess(`تم تحميل وتشغيل الملف: ${data.name}`);
                        
                        // إخفاء مؤشر التحميل
                        loading.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showError(`فشل تحميل الملف: ${error.message}`);
                        loading.classList.remove('active');
                    });
            }
            
            // دالة لتحويل رابط GitHub إلى رابط API
            function convertToApiUrl(githubUrl) {
                try {
                    // تحليل الرابط
                    const url = new URL(githubUrl);
                    
                    // التحقق من أن الرابط من GitHub
                    if (url.hostname !== 'github.com') {
                        return null;
                    }
                    
                    // استخراج مكونات المسار
                    const pathParts = url.pathname.split('/').filter(part => part);
                    
                    // يجب أن يكون هناك على الأقل اسم المستخدم واسم المستودع
                    if (pathParts.length < 2) {
                        return null;
                    }
                    
                    const [owner, repo, ...rest] = pathParts;
                    
                    // إزالة "blob" من المسار إذا كان موجوداً
                    const blobIndex = rest.indexOf('blob');
                    if (blobIndex !== -1) {
                        rest.splice(blobIndex, 1);
                    }
                    
                    // بناء رابط API
                    const filePath = rest.join('/');
                    return `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
                } catch (e) {
                    return null;
                }
            }
            
            // دالة لعرض محتوى الكود
            function displayCodeContent(content, filename, filepath) {
                // تنسيق الكود للألوان
                let formattedContent = content;
                
                // محاولة إضافة تمييز بسيط للكود
                formattedContent = formattedContent
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
                
                // تمييز العناصر الأساسية
                formattedContent = formattedContent
                    .replace(/(&lt;!--[\s\S]*?--&gt;)/g, '<span style="color: #6a9955;">$1</span>') // تعليقات HTML
                    .replace(/(&lt;\/?[a-zA-Z][^&]*&gt;)/g, '<span style="color: #569cd6;">$1</span>') // علامات HTML
                    .replace(/(&lt;script[\s\S]*?&gt;[\s\S]*?&lt;\/script&gt;)/gi, '<span style="color: #ce9178;">$1</span>') // سكريبت
                    .replace(/(&lt;style[\s\S]*?&gt;[\s\S]*?&lt;\/style&gt;)/gi, '<span style="color: #ce9178;">$1</span>') // ستايل
                
                codeContent.innerHTML = formattedContent;
            }
            
            // دالة لعرض معلومات الملف
            function displayFileInfo(data) {
                const sizeInKB = (data.size / 1024).toFixed(2);
                const downloadUrl = data.download_url || data.html_url;
                
                fileInfo.innerHTML = `
                    <h3><i class="fas fa-info-circle"></i> معلومات الملف</h3>
                    <p><strong>اسم الملف:</strong> ${data.name}</p>
                    <p><strong>المسار:</strong> ${data.path}</p>
                    <p><strong>الحجم:</strong> ${sizeInKB} كيلوبايت</p>
                    <p><strong>نوع الملف:</strong> ${data.type}</p>
                    <p><strong>رابط التنزيل:</strong> <a href="${downloadUrl}" target="_blank">${downloadUrl.substring(0, 50)}...</a></p>
                    <p><strong>SHA:</strong> ${data.sha.substring(0, 10)}...</p>
                `;
            }
            
            // دالة لعرض رسالة نجاح
            function showSuccess(message) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message success';
                statusMessage.style.display = 'block';
                
                // إخفاء الرسالة بعد 5 ثوانٍ
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            }
            
            // دالة لعرض رسالة خطأ
            function showError(message) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message error';
                statusMessage.style.display = 'block';
                
                // إخفاء الرسالة بعد 5 ثوانٍ
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            }
        });
    </script>
</body>
</html>