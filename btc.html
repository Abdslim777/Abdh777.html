<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>معدّن بيتكوين حقيقي (Python)</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    
    <style>
        body {
            background-color: #0f172a;
            color: #f8fafc;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            width: 100%;
            background: #1e293b;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            border: 1px solid #334155;
        }
        h1 { color: #f59e0b; text-align: center; }
        .stats {
            background: #0f172a;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            font-family: monospace;
            border-right: 4px solid #f59e0b;
        }
        #log {
            height: 300px;
            overflow-y: auto;
            background: #020617;
            padding: 1rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            color: #10b981;
        }
        .btn {
            background: #f59e0b;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 1.1rem;
        }
        .btn:hover { background: #d97706; }
        .loading-text { color: #94a3b8; font-size: 0.9rem; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h1>⛏️ معدّن بايثون الحقيقي</h1>
    <p style="text-align: center;">هذه الصفحة تشغل كود Python حقيقي لحساب SHA-256 المزدوج عبر WebAssembly.</p>
    
    <div class="stats">
        <div>الحالة: <span id="status">جاهز</span></div>
        <div>رقم الكتلة التجريبي: #800000</div>
        <div>الصعوبة: <span style="color: #f59e0b;">4 أصفار</span></div>
    </div>

    <button id="mine-btn" class="btn" py-click="start_mining">بدء التعدين الحقيقي</button>
    
    <div id="log">
        <p class="loading-text">جاري تحميل بيئة Python... يرجى الانتظار.</p>
    </div>
</div>

<script type="py">
import hashlib
import time
from pyscript import display

def start_mining(event):
    status_el = document.getElementById("status")
    log_el = document.getElementById("log")
    
    status_el.innerHTML = "⏳ جاري التعدين..."
    log_el.innerHTML = "" # تنظيف السجل
    
    # بيانات الكتلة
    prev_hash = "00000000000000000005af71eea30b6596540130635f9923"
    transactions = "User1->User2: 1 BTC"
    difficulty = 4
    prefix = '0' * difficulty
    
    nonce = 0
    start_time = time.time()
    
    # حلقة التعدين
    # سنقوم بـ 500,000 محاولة كحد أقصى لتجنب تجميد المتصفح
    max_attempts = 500000
    
    found = False
    while nonce < max_attempts:
        data = f"{prev_hash}{transactions}{nonce}"
        
        # التعدين الحقيقي: SHA256 مزدوج
        first_pass = hashlib.sha256(data.encode()).digest()
        final_hash = hashlib.sha256(first_pass).hexdigest()
        
        if final_hash.startswith(prefix):
            duration = time.time() - start_time
            display(f"✅ تم إيجاد كتلة!", target="log", append=True)
            display(f"الرقم السحري (Nonce): {nonce}", target="log", append=True)
            display(f"الهاش: {final_hash}", target="log", append=True)
            display(f"الوقت: {duration:.2f} ثانية", target="log", append=True)
            found = True
            break
        
        # عرض تحديث كل 5000 محاولة
        if nonce % 5000 == 0 and nonce > 0:
            display(f"تم فحص {nonce} هاش...", target="log", append=True)
            
        nonce += 1
    
    if not found:
        display("❌ انتهت المحاولات دون إيجاد حل، حاول مرة أخرى.", target="log", append=True)
    
    status_el.innerHTML = "✅ انتهى"
</script>

</body>
</html>
